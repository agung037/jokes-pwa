<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- add meta theme color -->
    <meta name="theme-color" content="#008080">
    <title>Jokes App</title>
    <!-- menghubungkan manifest.json -->
    <link rel="manifest" href="manifest.json">

    <!-- hubungkan style css -->
    <link rel="stylesheet" href="style.css">

    <!-- apple touch icon -->
    <link rel="apple-touch-icon" href="icons/manifest-icon-192.maskable.png">
</head>
<body>
    <div class="container">
        <h1>Random Jokes</h1>
        <div id="joke-container">
            <img id="joke-image" src="" alt="Random Joke" style="max-width: 100%; height: auto;">
            <p id="source-link" class="source-text"></p>
        </div>
        <button id="fetch-joke" class="fetch-button">Get New Joke</button>
    </div>

    <script>
        // Service Worker Registration
        if('serviceWorker' in navigator){
            navigator.serviceWorker.register('sw.js').then(registration => {
                console.log('service worker registered', registration);
            }).catch(err => {
                console.log('service worker not registered', err);
            });
        }else{
            console.log('serviceWorker is not supported');
        }

        // Joke Fetching Logic
        const jokeImage = document.getElementById('joke-image');
        const fetchButton = document.getElementById('fetch-joke');
        const sourceLink = document.getElementById('source-link');

        async function fetchJoke() {
            try {
                const response = await fetch('https://candaan-api.vercel.app/api/image/random');
                const data = await response.json();
                
                if (data.status === 200 && data.data) {
                    jokeImage.src = data.data.url;
                    sourceLink.textContent = `Source: ${data.data.source}`;
                } else {
                    throw new Error('Invalid response format');
                }
            } catch (error) {
                console.error('Error fetching joke:', error);
                jokeImage.src = '';
                sourceLink.textContent = 'Error loading joke. Please try again.';
            }
        }

        // Fetch joke when button is clicked
        fetchButton.addEventListener('click', fetchJoke);

        // Fetch initial joke when page loads
        fetchJoke();
    </script>
</body>
</html>